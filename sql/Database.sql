create database fprojecttT;
use fprojecttT;

-- CREATING TABLES

CREATE TABLE S_FACULTY (
    FAC_CODE CHAR(2) NOT NULL primary key,
    FAC_NAME VARCHAR(32),
    FAC_HEAD int,
    foreign key (FAC_HEAD) references  S_STAFF(STAFFNR)
);

CREATE TABLE S_DIPLOMA (
    DIP_CODE CHAR(2) NOT NULL primary key,
    DIP_NAME VARCHAR(25),
    DIP_HEAD int,
    FAC_CODE CHAR(2),
    foreign key (DIP_HEAD) references  S_STAFF(STAFFNR),
    
    foreign key (FAC_CODE) references  S_FACULTY(FAC_CODE)
);


CREATE TABLE S_SUBJECT (
    SUBJ_CODE CHAR(3) NOT NULL primary key,
    SUBJ_NAME VARCHAR(35),
    SUBJ_FEE decimal(6,2),
    HEADNR INT,
    DIP_CODE CHAR(2),
    PREREQ CHAR(3),
   foreign key (HEADNR) references  S_STAFF(STAFFNR),
	foreign key (DIP_CODE) references  S_DIPLOMA(DIP_CODE)
);

CREATE TABLE S_LECTURE (
	SUBJ_CODE CHAR(3),
    LECTURER_NR int,
	foreign key (LECTURER_NR) references  S_STAFF(STAFFNR),
    foreign key (SUBJ_CODE) references  S_SUBJECT(SUBJ_CODE)
);


CREATE TABLE S_STAFF (
    STAFFNR int NOT NULL primary key,
    SURNAME VARCHAR(15),
    INITIALS VARCHAR(4),
    OFFICE_NR VARCHAR(3),
    JOB VARCHAR(15),
    SALARY decimal(8,2),
    BONUS decimal(8,2)
);

CREATE TABLE S_REGISTRATION (
    STUDNR INT NOT NULL,
    SUBJ_CODE CHAR(3) NOT NULL,
    REG_DATE DATE,
    CAMPUS CHAR(1),
    FINALMARK INT,
    FOREIGN KEY (SUBJ_CODE) REFERENCES S_SUBJECT (SUBJ_CODE),
    FOREIGN KEY (STUDNR) REFERENCES S_STUDENT (STUDNR)
);

CREATE TABLE S_STUDENT (
    STUDNR INT NOT NULL PRIMARY KEY,
    SURNAME VARCHAR(15),
    INITIALS VARCHAR(15),
    SEX CHAR(1),
    BIRTHDATE DATE
);

-- ADDING VALUES
 INSERT INTO S_STAFF VALUES(300,"AfFRIDI", "SA", "6ER", "LECTURER", 50000, 1000);
 INSERT INTO S_STAFF VALUES(301, "AZAM", "AK", "4TF", "RECEPTION", 35000, 6000);
 INSERT INTO S_STAFF VALUES(302, "FAIZ", "AF","A2S", "DEAN", 80000, 30000);
 INSERT INTO S_STAFF VALUES(303, "HAMMAD", "AH", "GO0", "TUTOR", 20000, 700.9);
 INSERT INTO S_STAFF VALUES(304, "SHAIKH", "SS", "JK9","LECTURER", 55000, 9000);
 INSERT INTO S_STAFF VALUES(305, "GILANI", "OG", "6S9", "DRIVER", 10000, 400);
 INSERT INTO S_STAFF VALUES(306,"KHOLI", "VK","DS4","GUARD", 15000,800);
 
 INSERT INTO S_FACULTY VALUES("E6", "ENGINEERING",304);
 INSERT INTO S_FACULTY VALUES("B8", "ACCOUNTS", 303);
 INSERT INTO S_FACULTY VALUES("F7", "FINANCE", 303);
 INSERT INTO S_FACULTY VALUES("W2", "COMPUTER SCIENCE", 300);
 INSERT INTO S_FACULTY VALUES("M2","MECHANICAL ENGINEERING", 304);
 
 INSERT INTO S_DIPLOMA VALUES("D2", "INFORMATION TECHNOLOGY", 300,"W2");
 INSERT INTO S_DIPLOMA VALUES("D1","CHARTERED ACCOUNTS", 303, "B8");
 INSERT INTO S_DIPLOMA VALUES("D3", "ENGINNERING", 304, "F7");
 INSERT INTO S_DIPLOMA VALUES("D4", "CYBER SECURITY", 300, "E6");
 INSERT INTO S_DIPLOMA VALUES("D5", "DATA MINNING", 300, "M2");
 
 INSERT INTO S_SUBJECT VALUES("DB2", "PROGRAMMING FUNDAMENTALS", 7266, 300, "D2",NULL);
 INSERT INTO S_SUBJECT VALUES("DB3", "MARKETING", 2456, 303, "D2", NULL);
 INSERT INTO S_SUBJECT VALUES("DB4", "THERMODYNAMICS", 8000, 304, "D3","DB1");
 INSERT INTO S_SUBJECT VALUES("DB1", "GENERAL MECHANICS", 6000, 304, "D3", NULL);
 INSERT INTO S_SUBJECT VALUES("DB5", "OBJECT ORIENTED PROGRAMMING", 9800, 300, "D2","DB2");
 INSERT INTO S_SUBJECT VALUES("DB6", "SOFTWARE FRONTEND", 9000, 300, "D4",NULL);
 INSERT INTO S_SUBJECT VALUES("DB7", "SOFTWARE BACKEND", 9000, 300, "D4",NULL);
 INSERT INTO S_SUBJECT VALUES("DB8", "DEVELOPMENT SOFTWARE FRONTEND", 5000, 300, "D5","DB6");
 INSERT INTO S_SUBJECT VALUES("DB9", "DEVELOPMENT SOFTWARE BACKEND", 5000, 300, "D5","DB7");
 
 INSERT INTO S_LECTURE VALUES("DB2", 300);
 INSERT INTO S_LECTURE VALUES("DB3", 303);
 INSERT INTO S_LECTURE VALUES("DB1", 304);
 INSERT INTO S_LECTURE VALUES("DB4", 304);
 INSERT INTO S_LECTURE VALUES("DB5", 300);
 
 INSERT INTO S_STUDENT VALUES(0001,"CHEEMA", "OK", "M", STR_TO_DATE('10/08/2003', '%d/%m/%Y'));
 INSERT INTO S_STUDENT VALUES(0002,"KHATTAK", "MK", "M", STR_TO_DATE('5/11/2003', '%d/%m/%Y'));
 INSERT INTO S_STUDENT VALUES(0003,"NAQVI", "HN", "F", STR_TO_DATE('6/01/2004', '%d/%m/%Y'));
 INSERT INTO S_STUDENT VALUES(0004,"FAIZ", "AF", "M", STR_TO_DATE('12/9/2005', '%d/%m/%Y'));
 INSERT INTO S_STUDENT VALUES(0005,"SHAIKH", "SS", "M", STR_TO_DATE('23/09/2005', '%d/%m/%Y'));
 INSERT INTO S_STUDENT VALUES(0006,"GM MKASI", "RMG", "F", STR_TO_DATE('12/12/2004', '%d/%m/%Y'));
 
 INSERT INTO S_REGISTRATION VALUES(0001, "DB2", STR_TO_DATE('3/6/2021', '%d/%m/%Y'), "A", 67);
 INSERT INTO S_REGISTRATION VALUES(0002, "DB3", STR_TO_DATE('6/8/2021', '%d/%m/%Y'), "U", 93);
 INSERT INTO S_REGISTRATION VALUES(0003, "DB4", STR_TO_DATE('5/02/2022', '%d/%m/%Y'), "U", 56);
 INSERT INTO S_REGISTRATION VALUES(0004, "DB1", STR_TO_DATE('5/12/2022', '%d/%m/%Y'), "U", 81);
 INSERT INTO S_REGISTRATION VALUES(0005, "DB5", STR_TO_DATE('7/12/2022', '%d/%m/%Y'), "A", 99);
 INSERT INTO S_REGISTRATION VALUES(0006, "DB5", STR_TO_DATE('7/12/2022', '%d/%m/%Y'), "A", 99);
 
 -- C1
 SELECT JOB AS JOB_SPEC FROM S_STAFF WHERE JOB REGEXP'^(A|D|L|J)';

-- C2(USED 10,000 AS DIDNT HAVE ANYTHING GREATER THAN 50,000 AVG)
SELECT JOB AS JOB_SPEC,  CONCAT('$', FORMAT(AVG(salary), 2)) AS AVG_ANN_SAL
FROM S_STAFF 
GROUP BY JOB
HAVING AVG(SALARY)>10000
ORDER BY AVG(SALARY);

-- C3
SELECT DIP_NAME AS DIPLOMA, CONCAT(SURNAME, ' ',INITIALS) AS HEAD, COUNT(SUBJ_NAME) AS NR_OF_SUBJECTS
FROM S_DIPLOMA, S_STAFF, S_SUBJECT
WHERE S_DIPLOMA.DIP_HEAD=S_STAFF.STAFFNR AND S_SUBJECT.DIP_CODE=S_DIPLOMA.DIP_CODE
GROUP BY DIP_NAME 
ORDER BY NR_OF_SUBJECTS;

-- C4
SELECT CONCAT("THE PREREQUISITES OF ",SUBJ_NAME," IS ",PREREQ) AS DS_REQUIREMENTS
FROM S_SUBJECT
WHERE SUBJ_NAME LIKE "%DEVELOPMENT SOFTWARE%";

-- C5

SELECT CONCAT(INITIALS," ",SURNAME,", A ",SEX, " HAS REGISTERED ON THE ",DATE_FORMAT(REG_DATE, '%d %M %Y')) AS REGISTERED_STUDENTS
FROM S_STUDENT JOIN S_REGISTRATION ON S_STUDENT.STUDNR=S_REGISTRATION.STUDNR
where CAMPUS=(SELECT CAMPUS FROM S_REGISTRATION JOIN S_STUDENT ON S_STUDENT.STUDNR=S_REGISTRATION.STUDNR WHERE SURNAME LIKE "GM MKASI")
GROUP BY SURNAME;

-- C6

CREATE TABLE DIP_VIEW(HEAD_OF_DIPLOMA VARCHAR(25), DIPLOMA_NAME VARCHAR(25), AVG_FEE DECIMAL(10,2));

INSERT INTO DIP_VIEW (HEAD_OF_DIPLOMA, DIPLOMA_NAME, AVG_FEE)
SELECT CONCAT(INITIALS," ",SURNAME), DIP_NAME, AVG(SUBJ_FEE)
FROM S_DIPLOMA, S_STAFF, S_SUBJECT
WHERE S_DIPLOMA.DIP_HEAD=S_STAFF.STAFFNR AND S_DIPLOMA.DIP_CODE=S_SUBJECT.DIP_CODE
GROUP BY DIP_NAME;

SELECT * FROM DIP_VIEW;

-- C7
SELECT CONCAT(INITIALS," ",SURNAME," , ","A ",JOB," EARNS R",SALARY) AS HIGHEST_EARNING_EMPLOYEES
FROM S_STAFF
ORDER BY SALARY DESC
LIMIT 5;





